<div class="flex alignCenter justifySpaceBetween marBottom48" *ngIf="patient">
  <div class="flex alignCenter">
    <div class="picName marRight24">
      <img class="picName__img picName__img--big" [src]="patient.user.image_url" *ngIf="patient?.user.image_url" />
      <h1 class="noMargin">{{patient?.user.first_name}} {{patient?.user.last_name}}</h1>
    </div>
    <div class="drop">
      <div class="drop__input drop__input--select" (click)="planSelectOpen=!planSelectOpen">
        <h3 class="noMargin">{{selectedPlan?.plan_template.name}}<span *ngIf="selectedPlan?.plan_template.service_area">, {{selectedPlan.plan_template.service_area.name}}</span></h3>
      </div>
      <app-popover [visible]="planSelectOpen" (visibleChange)="planSelectOpen = $event;" [options]="planSelectOptions">
        <ul class="drop__dropdown drop__dropdown--select isOpen">
          <li class="drop__option drop__option--select" *ngFor="let plan of carePlans" (click)="changeSelectedPlan(plan)">
            <div class="iconText">
              <span>{{plan.plan_template.name}}</span><span *ngIf="plan.plan_template.service_area">, {{plan.plan_template.service_area.name}}</span>
            </div>
          </li>
        </ul>
      </app-popover>
    </div>
  </div>
  <div class="flex alignCenter">
    <div>
      <label class="noMargin marRight8">My Next <br>Check-In</label>
    </div>
    <div>
      <div class="datepicker">
        <div class="datepicker__date" (click)="showDate=!showDate">
          <span *ngIf="!selectedPlanCheckin">Select Date</span>
          <span *ngIf="selectedPlanCheckin">{{selectedPlanCheckin.format('ddd, MMM, D')}}</span>
        </div>
        <app-popover [visible]="showDate" (visibleChange)="showDate = $event;" [options]="datePickerOptions">
          <app-date-picker class="datepicker__picker isOpen" [selected]="selectedPlanCheckin" (selectedChange)="setCheckinDate($event)"></app-date-picker>
        </app-popover>
      </div> <!--/.datepicker-->
    </div>
  </div>
</div> <!--/.flex (for title area)-->

<div class="info info--horiz">
  <div class="info__cell">
    <label>Care Team</label>
    <div class="flex alignCenter justifyCenter">
      <div class="picName" *ngIf="careManager" [ngClass]="{'marRight8': careTeamMembers.length > 0}">
        <img class="picName__img" [src]="careManager.employee_profile.user.image_url" />
        {{careManager.employee_profile.user.first_name}} {{careManager.employee_profile.user.last_name}}<span *ngIf="careManager.employee_profile.title">, {{careManager.employee_profile.title.abbreviation}}</span>
      </div>
      <div class="tool__anchor" *ngIf="careTeamMembers.length > 0">
        <a class="flex alignCenter" (click)="teamListOpen=!teamListOpen">
          <span class="marRight8">+{{careTeamMembers.length}}</span>
          <img src="../../../assets/img/arrow-down.svg" />
        </a>
        <app-popover [visible]="teamListOpen" (visibleChange)="teamListOpen = $event;">
          <div class="tool__tip tool__tip--bottom isOpen">
            <div class="tool__text">
              <div class="picName" [ngClass]="{'marBottom16': (i + 1) !== careTeamMembers.length}" *ngFor="let teamMember of careTeamMembers; index as i">
                <img class="picName__img" [src]="teamMember.employee_profile.user.image_url" />
                {{teamMember.employee_profile.user.first_name}} {{teamMember.employee_profile.user.last_name}}<span *ngIf="teamMember.employee_profile.title">, {{teamMember.employee_profile.title.abbreviation}}</span>
              </div>
            </div>
          </div>
        </app-popover>
      </div>
    </div>
  </div> <!--/.info__cell (for care team)-->
  <div class="info__cell">
    <label>Progress</label>
    <div class="progress marCenter">
      Week 0 of {{selectedPlan?.plan_template?.duration_weeks}}
      <div class="progress__bg">
        <div class="progress__bar" [ngStyle]="{width: (3 / selectedPlan?.totalWeeks) * 100 + '%'}"></div>
      </div>
    </div>
  </div>
  <div class="info__cell">
    <label>Next&nbsp;Check-In</label>
    <a (click)="routeToPatientHistory()" class="justifyCenter" *ngIf="selectedPlan?.next_checkin">{{moment(selectedPlan?.next_checkin).fromNow()}}</a>
    <a (click)="routeToPatientHistory()" class="justifyCenter" *ngIf="!selectedPlan?.next_checkin">N/A</a>
  </div>
  <div class="info__cell">
    <label>Last&nbsp;Contact</label>
    <a (click)="routeToPatientHistory()" class="justifyCenter">N/A</a>
  </div>
  <div class="info__cell">
    <label>Problems</label>
    <a class="justifyCenter" (click)="openProblemAreas()">{{problemAreas.length}}</a>
  </div>
  <div class="info__cell">
    <label class="tool info__tool justifyCenter">
      Time
      <div class="tool__anchor">
        <button class="button button--icon button--icon--small" (click)="openFinancialDetails()">
          <i class="ss-info"></i>
        </button>
      </div>
    </label>
    <div class="pill">
      {{selectedPlanOverview?.time_spent_this_month}}
    </div>
  </div> <!--/.info__cell (for time)-->
  <div class="info__cell">
    <label>Risk Level</label>
    <div class="pill" [ngStyle]="{'background': utils.percentPillColor(patient?.risk_level)}">
      {{utils.getRiskLevelText(patient?.risk_level)}} {{patient?.risk_level}}%
    </div>
  </div>
</div> <!--/.info (for care plan instance)-->
