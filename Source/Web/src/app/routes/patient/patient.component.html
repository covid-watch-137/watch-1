<div class="ssContainer ssContents">
  <div class="flex alignCenter marBottom32">
    <div class="picName marRight8">
      <img class="picName__img picName__img--big" *ngIf="patient?.user.image_url" [src]="patient?.user.image_url" />
      <img class="picName__img picName__img--big" *ngIf="!patient?.user.image_url" src="../../../assets/img/profile.svg" />
      <div *ngIf="!editName" class="flex alignCenter">
        <h1 class="noMargin marRight8">{{patient?.user.first_name}} {{patient?.user.last_name}}</h1>
        <button class="button button--icon" (click)="editName=!editName">
          <i class="ss-write"></i>
        </button>
      </div>
      <form *ngIf="editName" class="flexForm">
        <input type="text" class="input flexForm__input" placeholder="First Name" />
        <input type="text" class="input flexForm__input" placeholder="Last Name" />
        <button class="button button--icon button--flex" (click)="editName=!editName">
          <i class="ss-undo"></i>
        </button>
        <button class="button button--icon button--flex" (click)="editName=!editName">
          <i class="ss-floppydisk"></i>
        </button>
      </form>
    </div>
  </div> <!--/.flex (for title area)-->

  <ng-container *ngFor="let plan of carePlans; let i = index">
    <div class="flex alignCenter justifySpaceBetween">
      <div class="flex alignCenter">
        <h2 class="noMargin marRight32">{{plan.plan_template.name}} <span *ngIf="plan.plan_template.type">{{plan.plan_template.type.abbreviation}}</span></h2>
        <a class="button button--iconText" (click)="openConsentForm(plan.id)">
          <i class="ss-standard ss-info"></i>
        </a>
        <a [routerLink]="['/patient', patient.id, 'dashboard', plan.id]" class="button button--iconText">
          <i class="ss-standard ss-view"></i> View Care Plan
        </a>
      </div>
      <div class="flex alignCenter">
        <!-- <button class="button button--icon"
        (click)="confirmPause()">
          <i class="ss-pause"></i>
        </button> -->
        <button class="button button--icon"
        (click)="confirmRemovePlan()">
          <i class="ss-delete"></i>
        </button>
      </div>
    </div>

    <div class="info info--horiz">
      <div class="info__cell">
        <label>Care Team</label>
        <div class="flex alignCenter justifyCenter">
          <div class="picName marRight8">
            <img class="picName__img" src="../../../assets/img/profile.svg" />
            {{plan.careTeam ? plan.careTeam[0]?.employee_profile?.user?.first_name + ' ' + plan.careTeam[0]?.employee_profile?.user?.last_name : ''}}
          </div>
          <div class="tool__anchor">
            <a class="flex alignCenter" (click)="teamListOpen === i ? teamListOpen = -1 : teamListOpen = i">
              <span class="marRight8">+2</span>
              <img src="../../../assets/img/arrow-down.svg" />
            </a>
            <div class="tool__tip tool__tip--bottom" [ngClass]="{ 'isOpen' : teamListOpen === i }">
              <div class="tool__text">
                <div *ngFor="let practitioner of plan.careTeam?.slice(1)" class="picName marBottom16">
                  <img class="picName__img" src="../../../assets/img/profile--2.svg" />
                  {{practitioner?.employee_profile?.user?.first_name + ' ' + practitioner?.employee_profile?.user?.last_name}}
                </div>
              </div>
            </div>
          </div>
        </div>
      </div> <!--/.info__cell (for care team)-->
      <div class="info__cell">
        <label>Progress</label>
        <div class="progress marCenter">
          Week {{plan.week}} of {{plan?.plan_template?.duration_weeks}}
          <div class="progress__bg">
            <div class="progress__bar" [ngStyle]="{width: (plan.week / plan.totalWeeks) * 100 + '%'}"></div>
          </div>
        </div>
      </div>
      <div class="info__cell">
        <label>Last&nbsp;Contact</label>
        <a [routerLink]="['/patient/asdf/history']" class="justifyCenter">{{plan.daysSinceContact}} days ago</a>
      </div>
      <div class="info__cell">
        <label>Problems</label>
        <a class="justifyCenter" (click)="openProblemAreas()">{{problemAreas.length}}</a>
      </div>
      <div class="info__cell">
        <label class="tool info__tool justifyCenter">
          Time
          <div class="tool__anchor">
            <button class="button button--icon button--icon--small" (click)="openFinancialDetails()">
              <i class="ss-info"></i>
            </button>
          </div>
        </label>
        <div class="pill pill--lime">
          {{plan.time}}
        </div>
      </div> <!--/.info__cell (for time)-->
      <div class="info__cell">
        <label>Risk Level</label>
        <div
          class="pill"
          [ngClass]="{
            'pill--red': plan.riskLevel >= 80,
            'pill--yellow': plan.riskLevel < 80 && plan.riskLevel >= 40,
            'pill--lime': plan.riskLevel < 40
          }"
        >
          {{riskLevelText[i]}} {{plan.riskLevel}}%
        </div>
      </div>
    </div> <!--/.info (for care plan instance)-->
  </ng-container>
  <button class="button button--iconText"
  (click)="addPatientToPlan(patient)">
    <i class="ss-plus"></i> Add Care Plan
  </button>

  <div class="divider divider--bigMargin halfWidth marCenter"></div>
<div class="background-radial">
  <div class="flex alignCenter marBottom16">
    <h2 class="noMargin">Patient Statistics (Past 12 Months)</h2>
    <div class="tool__anchor">
      <button class="button button--icon button--icon--small"
      (click)="tooltipPSOpen=!tooltipPSOpen">
        <i class="ss-help"></i>
      </button>
      <div class="tool__tip" [ngClass]="{'isOpen' : tooltipPSOpen }">
        <div class="tool__text">
          Patient Statistics are key indicators of patient risk.
        </div>
      </div>
    </div>
  </div> <!--/.flex (for patient statistics header and tooltip)-->

  <div class="info info--horiz">
    <div class="info__cell">
      <label>Readmits</label>
      {{patientStats?.readmissions_count}}
    </div>
    <div class="info__cell">
      <label>Readmit %</label>
      {{patientStats?.readmissions_percent}}
    </div>
    <div class="info__cell">
      <label>Cost of Readmits</label>
      {{patientStats?.readmissions_cost}}
    </div>
    <div class="info__cell">
      <label>ED Visits</label>
      {{patientStats?.ed_visits}}
    </div>
    <div class="info__cell">
      <label>Opioid Use</label>
      {{patientStats?.opioid_use}}
    </div>
  </div> <!--/.info (first one for patient stats)-->

  <div class="info info--horiz">
    <div class="info__cell">
      <label>Admits</label>
      {{patientStats?.admits}}
    </div>
    <div class="info__cell">
      <label>Avg Stay</label>
      {{patientStats?.avg_stay_length}}
    </div>
    <div class="info__cell">
      <label>PCP Visits</label>
      {{patientStats?.pcp_visits}}
    </div>
    <div class="info__cell">
      <label>Specialist Visits</label>
      {{patientStats?.specialist_visits}}
    </div>
    <div class="info__cell">
      <label>Total Cost</label>
      {{patientStats?.total_cost}}
    </div>
  </div> <!--/.info (second one for patient stats)-->
</div>

  <div class="divider divider--bigMargin halfWidth marCenter"></div>

  <h2>Patient Info</h2>

  <div class="cols">
    <div class="cols__colBig marRight32">
      <div class="info">
        <div class="info__header">
          <h3 class="noMargin">Profile</h3>
          <button class="button button--icon button--icon--small"
          (click)="editPatientProfile()">
            <i class="ss-write"></i>
          </button>
        </div>
        <div class="flex justifySpaceBetween">
          <div>
            <label class="info__label2">Age</label>
            <p class="info__p">{{patientAge}}</p>
            <label class="info__label2">Insurance</label>
            <p class="info__p">{{patient?.profile?.insurance}}</p>
            <label class="info__label2">Height</label>
            <p class="info__p info__p--noMargin">{{patient?.profile?.height}}</p>
          </div>
          <div>
            <label class="info__label2">Date of Birth</label>
            <p class="info__p">{{patient?.user?.birthdate}}</p>
            <label class="info__label2">Secondary Ins.</label>
            <p class="info__p">{{patient?.profile?.secondaryIns}}</p>
            <label class="info__label2">Ethnicity</label>
            <p class="info__p info__p--noMargin">{{patient?.profile?.ethnicity}}</p>
          </div>
          <div>
            <label class="info__label2">Gender</label>
            <p class="info__p">{{patient?.user?.gender ? patient?.user?.gender.toUpperCase() : ''}}</p>
            <label class="info__label2">MRN</label>
            <p class="info__p">{{patient?.profile?.MRN}}</p>
            <label class="info__label2">Cognitive Ability</label>
            <p class="info__p info__p--noMargin">{{patient?.profile?.cognitiveAbility}}</p>
          </div>
        </div>
      </div> <!--/.info (for profile)-->

      <div class="info">
        <div class="info__header">
          <h3 class="noMargin">Address</h3>
          <button class="button button--icon button--icon--small"
          (click)="editPatientAddress()">
            <i class="ss-write"></i>
          </button>
        </div>
        <div class="flex justifySpaceBetween">
          <div>
            <label class="info__label2">Street</label>
            <p class="info__p">{{patient?.address?.street}}</p>
            <label class="info__label2">State</label>
            <p class="info__p info__p--noMargin">{{patient?.address?.state}}</p>
          </div>
          <div>
            <label class="info__label2">Apt #</label>
            <p class="info__p">{{patient?.address?.apt ? patient?.address?.apt : '- -'}}</p>
            <label class="info__label2">ZIP</label>
            <p class="info__p info__p--noMargin">{{patient?.address?.zip}}</p>
          </div>
          <div>
            <label class="info__label2">City</label>
            <p class="info__p">{{patient?.address?.city}}</p>
          </div>
        </div>
      </div> <!--/.info (for address)-->
    </div> <!--/.cols__colBig-->

    <div class="cols__colSmall">
      <div class="info">
        <div class="info__header">
          <h3 class="noMargin">Communication</h3>
          <button class="button button--icon button--icon--small"
          (click)="editPatientCommunication()">
            <i class="ss-write"></i>
          </button>
        </div>
        <label class="info__label2">Email</label>
        <p class="info__p">
          <a href="mailto:">{{patient?.user?.email}}</a>
        </p>
        <div class="flex justifySpaceBetween">
          <div class="marRight32">
            <label class="info__label2">Phone</label>
            <p class="info__p info__p--noMargin">
              <a href="tel:">{{patient?.user?.phone}}</a>
            </p>
          </div>
          <div>
            <label class="info__label2">Comm. Preference</label>
            <p class="info__p info__p--noMargin">{{patient?.communication?.commPreference}}</p>
          </div>
        </div>
      </div> <!--/.info (for communication)-->

      <div class="info">
        <div class="info__header">
          <h3 class="noMargin">Emergency Contact</h3>
          <button class="button button--icon button--icon--small"
          (click)="editPatientEmergencyContact()">
            <i class="ss-write"></i>
          </button>
        </div>
        <div class="flex justifySpaceBetween">
          <div class="marRight32">
            <label class="info__label2">Name</label>
            <p class="info__p">{{patient?.emergencyContact?.name}}</p>
          </div>
          <div>
            <label class="info__label2">Relationship</label>
            <p class="info__p">{{patient?.emergencyContact?.relationship}}</p>
          </div>
        </div>
        <label class="info__label2">Phone</label>
        <p class="info__p">
          <a href="tel:">{{patient?.emergencyContact?.phone}}</a>
        </p>
        <label class="info__label2">Email</label>
        <p class="info__p info__p--noMargin">
          <a href="mailto:">{{patient?.emergencyContact?.email}}</a>
        </p>
      </div> <!--/.info (for emergency contact)-->

    </div> <!--/.cols__colSmall-->
  </div> <!--/.cols for profile, address, etc.-->

  <div class="flex justifySpaceBetween">
    <div class="info cols__colSmall marRight32">
      <h3>Medications</h3>
      <ul class="nameList nameList--dk marBottom16">
        <li *ngFor="let medication of patient?.medications" class="nameList__item">
          <span>{{medication}}</span>
          <div class="flex">
            <button class="button button--icon button--icon--small"
            (click)="editMedication()">
              <i class="ss-write"></i>
            </button>
            <button class="button button--icon button--icon--small"
            (click)="deleteMedication()">
              <i class="ss-delete"></i>
            </button>
          </div>
        </li>
      </ul>
      <button class="button button--iconText"
      (click)="addMedication()">
        <i class="ss-plus"></i> Add Medication
      </button>
    </div> <!--/.info (for medications)-->

    <div class="info cols__colSmall marRight32">
      <h3>Diagnoses</h3>
      <ul class="nameList nameList--dk marBottom16">
        <li class="nameList__item" *ngFor="let diagnosis of patientDiagnoses">
          <span>{{diagnosis.name}}</span>
          <div class="flex">
            <button class="button button--icon button--icon--small"
            (click)="editDiagnosis()">
              <i class="ss-write"></i>
            </button>
            <button class="button button--icon button--icon--small"
            (click)="deleteDiagnosis(diagnosis)">
              <i class="ss-delete"></i>
            </button>
          </div>
        </li>
      </ul>
      <button class="button button--iconText"
      (click)="addDiagnosis()">
        <i class="ss-plus"></i> Add Diagnosis
      </button>
    </div> <!--/.info (for diagnoses)-->

    <div class="info cols__colSmall">
      <h3>Procedures</h3>
      <ul class="nameList nameList--dk marBottom16">
        <li class="nameList__item" *ngFor="let patientProcedure of patientProcedures">
          <span>{{patientProcedure.procedure.name}}</span>
          <div class="flex">
            <button class="button button--icon button--icon--small"
            (click)="editProcedure(patientProcedure)">
              <i class="ss-write"></i>
            </button>
            <button class="button button--icon button--icon--small"
            (click)="deleteProcedure(patientProcedure)">
              <i class="ss-delete"></i>
            </button>
          </div>
        </li>
      </ul>
      <button class="button button--iconText"
      (click)="addProcedure()">
        <i class="ss-plus"></i> Add Procedure
      </button>
    </div> <!--/.info (for diagnoses)-->

  </div> <!--/.flex (for medications, diagnoses, procedures)-->

  <button class="button button--2nd"
  (click)="confirmMakePatientInactive()">
    Make Inactive
  </button>

</div> <!--/.ssContainer-->
